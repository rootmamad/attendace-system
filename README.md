معرفی
این برنامه با پایتون و کتابخانه flask توسعه داده شده است. این برنامه شامل 3 میکرو سرویس و یک کلاینت میباشد.
یک میکروسرویس برای ورود کارمند به سرویس و یک میکرو سرویس برای ثبت ورود و خروج و یک میکرو سرویس برای نمایش زنده ورود و خروج ها میباشد.
از REST و gRPC , websocket برای API استفاده شده است. همچنین برای امنیت تمام داده های اشتراک گذاری شده اینها با JWT رمز گذاری میشوند.
توجه: در پروژه از پورت های 8001 و 8002 و 8103 و 5500 و 50051 و5432. باید خالی باشند.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
راه اندازی و نصب:
1.گیت را رپو کنید.
git clone https://github.com/rootmamad/attendance-system.git
cd attendance-system
2.با استفاده از داکر
docker compose up --build
حالا برید به http://127.0.0.1:5500/index.html ، تمام.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
میکرو سرویس auth service
این میکرو سرویس شامل فایل های app.py , routes.py , db.py , jwt_utils.py , DockerFile , requruirments.txt است و روی پورت 8001 اجرا میشود.
app.py
اجرای کلی میکروسرویس 
jwt_utils.py
این فایل وظیفه رمزگذاری داده ها و رمزگشایی انها و همچنین ایجاد  یک دکوریتور برای اینکه برای در همه درخواست ها نقش middleware را بازی کند و همه داده ها را با jwt تطبیق دهد، را بر عهده دارد.
db.py
این فایل برای کانکت شدن به دیتا بیس و جلوگیری از تکرار آن و کثیف شدن کد میباشد. 
requruirments.txt
کتابخانه هایی که در میکرو سرویس استفاده شده اند را نمایش میدهد که برای نصب و configuration داکر نیاز است.
routes.py
اصل میکرو سرویس در این فایل نهفته است و این فایل حاوی یک بلو پرینت از فلسک  و 3 اندپوینت برای ثبت نام و لاگین و دریافت لیست کارمندان هست. هر سه از  rest استفاده میکنند و در با این فایل میتوانیم ثبت نام یا ورود کنیم  یا لیست کارمندان را ببینیم.

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


attendance_service
این میکرو سرویس شامل فایل های grpc_server.py , proto , app.py , routes_rest.py , db.py , jwt_utils.py , DockerFile , requruirments.txt است و روی پورت 8002 اجرا میشود.
کارکرد db   , app , jwt_utils مانند میکرو سرویس قبلیست.
grpc_server.py و proto
این فایل برای پیکر بندی grpc هست، که شامل یک کلاس هست که برای اینکه برنامه بتواند همزمان درخوسات ها را پردازش کند با async نوشته شده است. یک متود از کلاس برای لیست ورود و خروج نوشته شده است و یک متود دیگر برای استریم همزمان داده ها. همانطور که میدانید برای ساختار بندی اولیه grpc باید فایل proto داشته باشیم
و آنها را به فایل .py تبدیل کنیم نا بتوانیم از انها استفاده کنیم.این کار در اینجا صورت گرفته است 

routes_rest.py
این فایل یک بلو پرینت فلسک در خود دارد و درخواست ها را با gRPC کنترل میکند و ورود و خروج کارمندان را چک میکند. دو اندپوینت دارد یکی برای ثبت خروج یا ورود کاربر و دیگری برای لیست ورودی ها و خروجی ها در یک روز اخیر.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

reporter_service

این میکروسرویس که با وب سوکت کار میکند وظیقه بروزرسانی زنده درخواست های ورود و خروج به شرکت را برعهده دارد. یک فایل اصلی app.py دارد که شامل دو اند پوینتاست.  روی پورت 8103 است.

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

بخش client 
یک صفحه html ساده طراحی شده است که برای ساده سازی درخواست ها و تست صورت گرفته است. برای اجرا http://127.0.0.1:5500/index.html را در مرورگر اچرا کنید.

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
docker-compose.yml 
برای پیکر بندی داکر فایل ها و بالا امدن پروژه  

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
.env
برای نامدهی به متغیر های خاص و جلوگیری از ویرایش همه فایل ها در صورت تغییر.


----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
تیت سرویس ها
1.register(auth)

curl -X POST http://localhost:8001/register \
  -H "Content-Type: application/json" \
  -d '{"username":"emp2","password":"1234"}'

  2.login(auth)

  curl -X POST http://localhost:8001/login \
  -H "Content-Type: application/json" \
  -d '{"username":"emp2","password":"1234"}'

  که حروجی توکن است.

3.Attendance.List (gRPC)
  grpcurl -plaintext \
  -d '{"employee_id":1,"jwt":"<JWT_TOKEN>"}' \
  localhost:50051 proto.AttendanceService.List

  این تمام ورود و خروج های کاربر رو برمیگردونه.

  4. Attendance.StreamNew (gRPC – استریم زنده)
  grpcurl -plaintext \
  -d '{"employee_id":1,"jwt":"<JWT_TOKEN>"}' \
  localhost:50051 proto.AttendanceService.StreamNew

استریم میکنه و رکورد جدید میفرسته 


5. Reporter (WebSocket)

wscat -c "ws://localhost:8103/ws?token=<JWT_TOKEN>"

هر بار که Attendance رکورد جدید ثبت کنه، Reporter اون رو به کلاینت‌های WS پخش می‌کنه.














